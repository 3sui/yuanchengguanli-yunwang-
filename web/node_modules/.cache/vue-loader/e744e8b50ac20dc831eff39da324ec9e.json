{"remainingRequest":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\hualiyeya\\web\\src\\components\\Map\\map.vue?vue&type=style&index=1&lang=css&","dependencies":[{"path":"D:\\git\\hualiyeya\\web\\src\\components\\Map\\map.vue","mtime":1593497167627},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_css-loader@3.5.3@css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_postcss-loader@3.0.0@postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.el-progress-circle {\r\n    height: 100px !important;\r\n    width: 100px !important;\r\n}\r\n.BMap_Marker img {\r\n    width: 40px;\r\n}\r\n",{"version":3,"sources":["map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6UA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.vue","sourceRoot":"src/components/Map","sourcesContent":["<!--\r\n * @Author: your name\r\n * @Date: 2020-04-28 16:25:21\r\n * @LastEditTime: 2020-06-29 16:02:19\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\远程监控平台\\vue-manage-system\\src\\components\\page\\map.vue\r\n -->\r\n <template>\r\n    <div id=\"maps\">\r\n        <div class=\"crumbs\">\r\n            <el-breadcrumb separator=\"/\">\r\n                <el-breadcrumb-item>\r\n                    <i class=\"el-icon-lx-emoji\"></i> 用户地图\r\n                </el-breadcrumb-item>\r\n            </el-breadcrumb>\r\n        </div>\r\n        <div>\r\n            <el-row class=\"container\">\r\n                <el-col :span=\"18\">\r\n                    <div class=\"mapbox\">\r\n                        <baidu-map\r\n                            class=\"map\"\r\n                            center=\"中国\"\r\n                            :map-click=\"false\"\r\n                            v-if=\"allDevice\"\r\n                            :scroll-wheel-zoom=\"true\"\r\n                        >\r\n                            <bml-marker-clusterer :averageCenter=\"true\">\r\n                                <div v-for=\"(marker, i) of allDevice\" :key=\"i\">\r\n                                    <bm-marker\r\n                                        :icon=\"{url: marker.status == '正常'? require('../../../public/bposition.png') :  marker.status == '报警' ? require('../../../public/rposition.png') : require('../../../public/yposition.png'), size: {width: 60, height: 60}}\"\r\n                                        :dragging=\"true\"\r\n                                        animation=\"BMAP_ANIMATION_BOUNCE\"\r\n                                        :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                        @click=\"infoWindowOpen(marker)\"\r\n                                    >\r\n                                        <bm-info-window\r\n                                            title=\"设备信息\"\r\n                                            :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                            :show=\"marker.showFlag\"\r\n                                            @close=\"infoWindowClose(marker)\"\r\n                                            @open=\"infoWindowOpen(marker)\"\r\n                                        >\r\n                                            <p>公司: {{marker.device_supplier}}</p>\r\n                                            <p>地址: {{marker.address}}</p>\r\n                                            <p>设备ID: {{marker.eq}}</p>\r\n                                            <p>设备状态: {{marker.is_on == '0'?'关机':'开机'}}</p>\r\n                                            <p>设备报警: {{marker.status}}</p>\r\n                                            <el-button\r\n                                                class=\"my-2\"\r\n                                                @click=\"showDrawer(marker.id)\"\r\n                                            >查看更多</el-button>\r\n                                        </bm-info-window>\r\n                                    </bm-marker>\r\n                                </div>\r\n                            </bml-marker-clusterer>\r\n                        </baidu-map>\r\n                    </div>\r\n                </el-col>\r\n                <el-col :span=\"6\">\r\n                    <div class=\"map-info\">\r\n                        <div class=\"info-one\">\r\n                            <p>{{deviceNum}}</p>\r\n                            <p>设备总数</p>\r\n                        </div>\r\n                        <div class=\"info-one\">\r\n                            <!-- <el-progress type=\"circle\" :percentage=\"100\"></el-progress> -->\r\n                            <div>\r\n                                <p>{{run}}</p>\r\n                                <p>运行设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-one\">\r\n                            <!-- <el-progress type=\"circle\" :percentage=\"0\"></el-progress> -->\r\n                            <div>\r\n                                <p>{{bed}}</p>\r\n                                <p>异常设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-one\">\r\n                            <!-- <el-progress type=\"circle\" :percentage=\"0\"></el-progress> -->\r\n                            <div>\r\n                                <p>{{repair}}</p>\r\n                                <p>累计维修数</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </el-col>\r\n            </el-row>\r\n        </div>\r\n        <el-drawer\r\n            :title=\"drawerData.device_name\"\r\n            :visible.sync=\"drawer\"\r\n            direction=\"rtl\"\r\n            size=\"35%\"\r\n        >\r\n            <div class=\"w-100 px-4\">\r\n                <div class=\"d-flex jc-around my-2\">\r\n                    <el-image\r\n                        v-for=\"(item, index) in imgList\"\r\n                        :key=\"index\"\r\n                        style=\"width: 100px; height: 100px\"\r\n                        :src=\"axios.defaults.baseURL.slice(0, -4) + item.file_path.split('.').shift()\"\r\n                        fit=\"scale-down\"\r\n                    ></el-image>\r\n                </div>\r\n                <div class=\"fs-lg device_info\">\r\n                    <p>设备id: {{drawerData.eq}}</p>\r\n                    <p>设备名称: {{drawerData.device_name}}</p>\r\n                    <p>设备型号: {{drawerData.device_model}}</p>\r\n                    <p>工作状态: {{drawerData.status}}</p>\r\n                    <p>设备地址: {{drawerData.address}}</p>\r\n                    <p>设备负责人: {{drawerData.username}}</p>\r\n                </div>\r\n\r\n                <el-button\r\n                    @click=\"$router.push({path: '/ProductDetails', query: {\r\n                        id: drawerData.id\r\n                    }})\"\r\n                >跳转到详情页</el-button>\r\n                <div class=\"d-flex flex-column ai-start jc-between\">\r\n                    <a\r\n                        target=\"_blank\"\r\n                        :href=\"axios.defaults.baseURL.slice(0, -4) + item.file_path\"\r\n                        :underline=\"false\"\r\n                        style=\"margin-top:15px\"\r\n                        v-for=\"(item, index) in wordList\"\r\n                        :key=\"index\"\r\n                    >\r\n                        <el-button size=\"mini\" type=\"warning\">{{item.file_name}} 下载</el-button>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </el-drawer>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { BmlMarkerClusterer } from 'vue-baidu-map';\r\n// 引入marker\r\nimport BmMarker from 'vue-baidu-map/components/overlays/Marker';\r\n\r\nexport default {\r\n    name: 'maps',\r\n    data() {\r\n        return {\r\n            drawerData: {},\r\n            drawer: false,\r\n            allDevice: null,\r\n            BMap: '',\r\n            map: '',\r\n            show: false,\r\n            deviceNum: 0,\r\n            repair: 0,\r\n            run: 0,\r\n            bed: 0,\r\n            imgList: [],\r\n            wordList: []\r\n        };\r\n    },\r\n\r\n    components: {\r\n        BmlMarkerClusterer,\r\n        BmMarker\r\n    },\r\n\r\n    computed: {},\r\n    created() {\r\n        this.fetchAllDevice();\r\n        this.fetchDeviceNum();\r\n    },\r\n    methods: {\r\n        //显示侧边栏设备详情\r\n        showDrawer(id) {\r\n            window.console.log(id);\r\n            this.drawerData = this.allDevice.filter(item => {\r\n                return item.id == id;\r\n            })[0];\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchImgList',\r\n                params: {\r\n                    id: id\r\n                }\r\n            }).then(res => {\r\n                if (res.data.success) {\r\n                    window.console.log(res.data);\r\n\r\n                    this.imgList = res.data.list.filter(item => {\r\n                        return item.type == 'img';\r\n                    });\r\n                    this.wordList = res.data.list.filter(item => {\r\n                        return item.type == 'word';\r\n                    });\r\n                    window.console.log(this.imgList);\r\n                }\r\n            });\r\n            window.console.log(this.drawerData);\r\n            this.drawer = true;\r\n        },\r\n        // 关闭信息窗口 @close 自带的方法\r\n        infoWindowClose(marker) {\r\n            marker.showFlag = false;\r\n            console.log(marker);\r\n        },\r\n        // 首先点击marker时开启信息窗口，其实没必要在 bm-info-window 上写 @open 因为如果是关闭状态根本就点不到，所以就无法触发 @open\r\n        // 如果在 bm-info-window 上写了 @open 在点击marker时会触发两次infoWindowOpen函数，而且可以很明显的看到有延时\r\n        infoWindowOpen(marker) {\r\n            marker.showFlag = true;\r\n            // axios({\r\n            //     method: 'get',\r\n            //     url: 'getDeviceInfo',\r\n            //     query: ''\r\n            // });\r\n            console.log(marker);\r\n        },\r\n        //获取企业设备数量\r\n        fetchDeviceNum() {\r\n            axios({\r\n                method: 'get',\r\n                url: '/home/fetchDeviceInfo'\r\n            })\r\n                .then(res => {\r\n                    window.console.log(res);\r\n                    if (res.data.success) {\r\n                        this.repair = res.data.repair;\r\n                        this.unread = res.data.unread;\r\n                        this.read = res.data.read;\r\n                        this.run = res.data.run;\r\n                        this.bed = res.data.bed;\r\n                        this.deviceNum = res.data.deviceNum;\r\n                    }\r\n                })\r\n                .catch(err => {\r\n                    window.console.log(err);\r\n                });\r\n        },\r\n\r\n        //获取所有设备数据\r\n        fetchAllDevice() {\r\n            // window.console.log(BMap);\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchAllDevice'\r\n            }).then(res => {\r\n                if (res.data.success) {\r\n                    this.allDevice = res.data.data;\r\n                    window.console.log(this.allDevice);\r\n                    let addressArr = [];\r\n                    this.allDevice.forEach(item => {\r\n                        addressArr.push(item.address);\r\n                    });\r\n\r\n                    /***************************************** */\r\n                    var index = 0;\r\n                    var myGeo;\r\n\r\n                    //否则会报错BMap.Geocoder is not a constructor\r\n                    setTimeout(() => {\r\n                        myGeo = new BMap.Geocoder();\r\n                        bdGEO();\r\n                    }, 500);\r\n                    let _this = this;\r\n                    function bdGEO() {\r\n                        for (let i = 0; i < _this.allDevice.length; i++) {\r\n                            myGeo.getPoint(_this.allDevice[i].address, function(point) {\r\n                                if (point) {\r\n                                    _this.$set(_this.allDevice[i], 'lng', point.lng);\r\n                                    _this.$set(_this.allDevice[i], 'lat', point.lat);\r\n                                    _this.$set(_this.allDevice[i], 'showFlag', point.showFlag);\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    window.console.log(this.allDevice);\r\n                }\r\n            });\r\n        }\r\n    }\r\n};\r\n</script>\r\n<style scoped>\r\n.map {\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    margin-left: 20px;\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info > div {\r\n    box-sizing: border-box;\r\n    /* margin-bottom: 13.3px; */\r\n    padding: 15px;\r\n    height: 22%;\r\n    background-color: #eef1f6;\r\n}\r\n.info-one {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    text-align: center;\r\n    line-height: 1.5;\r\n    font-size: 26px;\r\n    color: #333;\r\n}\r\n.info-two,\r\n.info-three,\r\n.info-four {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n}\r\n.info-two > div p:nth-child(1),\r\n.info-three > div p:nth-child(1),\r\n.info-four > div p:nth-child(1) {\r\n    font-size: 26px;\r\n}\r\n.img {\r\n    width: 90px;\r\n    height: 90px;\r\n    background: red;\r\n}\r\n.device_info p {\r\n    line-height: 40px;\r\n}\r\n</style>\r\n<style>\r\n.el-progress-circle {\r\n    height: 100px !important;\r\n    width: 100px !important;\r\n}\r\n.BMap_Marker img {\r\n    width: 40px;\r\n}\r\n</style>\r\n"]}]}
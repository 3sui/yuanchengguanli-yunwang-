{"remainingRequest":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\hualiyeya\\web\\src\\components\\view\\map.vue?vue&type=style&index=0&id=4cb46602&scoped=true&lang=css&","dependencies":[{"path":"D:\\git\\hualiyeya\\web\\src\\components\\view\\map.vue","mtime":1591091697323},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_css-loader@1.0.1@css-loader\\index.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_postcss-loader@3.0.0@postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.map {\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    margin-left: 20px;\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info > div {\r\n    box-sizing: border-box;\r\n    /* margin-bottom: 13.3px; */\r\n    padding: 15px;\r\n    height: 22%;\r\n    background-color: #eef1f6;\r\n}\r\n.info-one {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    text-align: center;\r\n    line-height: 1.5;\r\n    font-size: 26px;\r\n    color: #333;\r\n}\r\n.info-two,\r\n.info-three,\r\n.info-four {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n}\r\n.info-two > div p:nth-child(1),\r\n.info-three > div p:nth-child(1),\r\n.info-four > div p:nth-child(1) {\r\n    font-size: 26px;\r\n}\r\n",{"version":3,"sources":["map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.vue","sourceRoot":"src/components/view","sourcesContent":["<!--\r\n * @Author: your name\r\n * @Date: 2020-04-28 16:25:21\r\n * @LastEditTime: 2020-06-01 18:02:01\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\远程监控平台\\vue-manage-system\\src\\components\\page\\map.vue\r\n -->\r\n <template>\r\n    <div id=\"maps\">\r\n        <div class=\"crumbs\">\r\n            <el-breadcrumb separator=\"/\">\r\n                <el-breadcrumb-item>\r\n                    <i class=\"el-icon-lx-emoji\"></i> 用户地图\r\n                </el-breadcrumb-item>\r\n            </el-breadcrumb>\r\n        </div>\r\n        <div>\r\n            <el-row class=\"container\">\r\n                <el-col :span=\"18\">\r\n                    <div class=\"mapbox\">\r\n                        <baidu-map class=\"map\" center=\"中国\" :map-click=\"false\" v-if=\"allDevice\">\r\n                            <bml-marker-clusterer :averageCenter=\"true\">\r\n                                <div v-for=\"(marker, i) of allDevice\" :key=\"i\">\r\n                                    <bm-marker\r\n                                        :icon=\"{url: 'https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1591015785174&di=0f3d1082e6d3de97a898b433b136582f&imgtype=0&src=http%3A%2F%2Fimages.669pic.com%2Felement_pic%2F90%2F37%2F17%2F46%2Fdd97a3cd5a139633ceb99f292b1aea8c.jpg%2521w700wb', size: {width: 300, height: 157}}\"\r\n                                        :dragging=\"false\"\r\n                                        animation=\"BMAP_ANIMATION_BOUNCE\"\r\n                                        :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                        @click=\"infoWindowOpen(marker)\"\r\n                                    >\r\n                                        <bm-info-window\r\n                                            title=\"设备信息\"\r\n                                            :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                            :show=\"marker.showFlag\"\r\n                                            @close=\"infoWindowClose(marker)\"\r\n                                            @open=\"infoWindowOpen(marker)\"\r\n                                        >\r\n                                            <p>公司: {{marker.device_supplier}}</p>\r\n                                            <p>地址: {{marker.address}}</p>\r\n                                            <p>设备ID: {{marker.eq}}</p>\r\n                                            <p>设备状态: {{marker.is_on?'开机':'关机'}}</p>\r\n                                            <p>设备报警: 0</p>\r\n                                        </bm-info-window>\r\n                                    </bm-marker>\r\n                                </div>\r\n                            </bml-marker-clusterer>\r\n                        </baidu-map>\r\n                    </div>\r\n                </el-col>\r\n                <el-col :span=\"6\">\r\n                    <div class=\"map-info\">\r\n                        <div class=\"info-one\">\r\n                            <p>{{deviceNum}}</p>\r\n                            <p>设备数量</p>\r\n                        </div>\r\n                        <div class=\"info-two\">\r\n                            <el-progress type=\"circle\" :percentage=\"status.yxs*2\" v-if=\"status.yxs\"></el-progress>\r\n                            <div>\r\n                                <p>{{status.yxs}}</p>\r\n                                <p>运行设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-three\">\r\n                            <el-progress\r\n                                type=\"circle\"\r\n                                :percentage=\"(deviceNum-status.yxs)*2\"\r\n                                v-if=\"status.yxs\"\r\n                            ></el-progress>\r\n                            <div>\r\n                                <p>{{deviceNum-status.yxs}}</p>\r\n                                <p>关机设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-four\">\r\n                            <el-progress type=\"circle\" :percentage=\"status.djs*2\" v-if=\"status.yxs\"></el-progress>\r\n                            <div>\r\n                                <p>{{status.djs}}</p>\r\n                                <p>设备故障数</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </el-col>\r\n            </el-row>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { BmlMarkerClusterer } from 'vue-baidu-map';\r\n// 引入marker\r\nimport BmMarker from 'vue-baidu-map/components/overlays/Marker';\r\n// 插入 100 个随机点\r\n// const markers = [\r\n//     {\r\n//         lng: 119.946973,\r\n//         lat: 31.772752,\r\n//         // url: 'http://developer.baidu.com/map/jsdemo/img/fox.gif',\r\n//         company: '江苏常州华丽液压润滑设备有限公司',\r\n//         address: '中国 江苏 常州市 三河口',\r\n//         deviceId: '10000093803899',\r\n\r\n//         showFlag: false\r\n//     },\r\n//     {\r\n//         lng: 119.946973,\r\n//         lat: 31.772752,\r\n//         // url: 'http://developer.baidu.com/map/jsdemo/img/fox.gif',\r\n//         company: '江苏常州华丽液压润滑设备有限公司',\r\n//         address: '中国 江苏 常州市 三河口',\r\n//         deviceId: '10000093803934',\r\n\r\n//         showFlag: false\r\n//     },\r\n//     {\r\n//         lng: 119.946973,\r\n//         lat: 31.772752,\r\n//         // url: 'http://developer.baidu.com/map/jsdemo/img/fox.gif',\r\n//         company: '江苏常州华丽液压润滑设备有限公司',\r\n//         address: '中国 江苏 常州市 三河口',\r\n//         deviceId: '10000093803937',\r\n//         showFlag: false\r\n//     }\r\n// ];\r\n\r\nconst carList = [{}];\r\nexport default {\r\n    name: 'maps',\r\n    data() {\r\n        return {\r\n            imgUrl: ['./src/assets/img/bpositon.png'],\r\n            allDevice: null,\r\n            BMap: '',\r\n            map: '',\r\n            carList,\r\n            show: false,\r\n            deviceNum: 0,\r\n            status: {}\r\n        };\r\n    },\r\n\r\n    components: {\r\n        BmlMarkerClusterer,\r\n        BmMarker\r\n    },\r\n\r\n    computed: {},\r\n    created() {\r\n        this.fetchAllDevice();\r\n        this.fetchDeviceNum();\r\n        this.fetchDeviceStatus();\r\n    },\r\n    methods: {\r\n        // 关闭信息窗口 @close 自带的方法\r\n        infoWindowClose(marker) {\r\n            marker.showFlag = false;\r\n            console.log(marker);\r\n        },\r\n        // 首先点击marker时开启信息窗口，其实没必要在 bm-info-window 上写 @open 因为如果是关闭状态根本就点不到，所以就无法触发 @open\r\n        // 如果在 bm-info-window 上写了 @open 在点击marker时会触发两次infoWindowOpen函数，而且可以很明显的看到有延时\r\n        infoWindowOpen(marker) {\r\n            marker.showFlag = true;\r\n            // axios({\r\n            //     method: 'get',\r\n            //     url: 'getDeviceInfo',\r\n            //     query: ''\r\n            // });\r\n            console.log(marker);\r\n        },\r\n        //获取企业设备数量\r\n        fetchDeviceNum() {\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchDeviceNum'\r\n            })\r\n                .then(res => {\r\n                    if (res.data.success) {\r\n                        this.deviceNum = res.data.data;\r\n                        // window.console.log(res.data.data);\r\n                    }\r\n                })\r\n                .catch();\r\n        },\r\n\r\n        //获取企业设备数量\r\n        async fetchDeviceAddress() {},\r\n\r\n        //获取企业设备各种状态的数据\r\n        fetchDeviceStatus() {\r\n            // axios({\r\n            //     method: 'get',\r\n            //     url: '/fetchDeviceStatus'\r\n            // })\r\n            //     .then(res => {\r\n            //         this.status = res.data;\r\n            //     })\r\n            //     .catch();\r\n        },\r\n\r\n        //获取所有设备数据\r\n        fetchAllDevice() {\r\n            // window.console.log(BMap);\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchAllDevice'\r\n            }).then(res => {\r\n                if (res.data.success) {\r\n                    this.allDevice = res.data.data;\r\n                    window.console.log(this.allDevice);\r\n                    let addressArr = [];\r\n                    this.allDevice.forEach(item => {\r\n                        addressArr.push(item.address);\r\n                    });\r\n\r\n                    /***************************************** */\r\n                    var index = 0;\r\n                    var myGeo;\r\n\r\n                    //否则会报错BMap.Geocoder is not a constructor\r\n                    setTimeout(() => {\r\n                        myGeo = new BMap.Geocoder();\r\n                        bdGEO();\r\n                    }, 500);\r\n                    let _this = this;\r\n                    function bdGEO() {\r\n                        for (let i = 0; i < _this.allDevice.length; i++) {\r\n                            myGeo.getPoint(_this.allDevice[i].address, function(point) {\r\n                                if (point) {\r\n                                    _this.$set(_this.allDevice[i], 'lng', point.lng);\r\n                                    _this.$set(_this.allDevice[i], 'lat', point.lat);\r\n\r\n                                    _this.$set(_this.allDevice[i], 'showFlag', point.showFlag);\r\n\r\n                                    // _this.allDevice[i].lng = point.lng;\r\n                                    // _this.allDevice[i].lat = point.lat;\r\n                                    // _this.allDevice[i].showFlag = false;\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    window.console.log(this.allDevice);\r\n                }\r\n            });\r\n        }\r\n    }\r\n};\r\n</script>\r\n<style scoped>\r\n.map {\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    margin-left: 20px;\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info > div {\r\n    box-sizing: border-box;\r\n    /* margin-bottom: 13.3px; */\r\n    padding: 15px;\r\n    height: 22%;\r\n    background-color: #eef1f6;\r\n}\r\n.info-one {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    text-align: center;\r\n    line-height: 1.5;\r\n    font-size: 26px;\r\n    color: #333;\r\n}\r\n.info-two,\r\n.info-three,\r\n.info-four {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n}\r\n.info-two > div p:nth-child(1),\r\n.info-three > div p:nth-child(1),\r\n.info-four > div p:nth-child(1) {\r\n    font-size: 26px;\r\n}\r\n</style>\r\n<style>\r\n.el-progress-circle {\r\n    height: 100px !important;\r\n    width: 100px !important;\r\n}\r\n</style>\r\n"]}]}
{"remainingRequest":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\hualiyeya\\web\\src\\components\\deviceRecord\\AddNewProduct.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\git\\hualiyeya\\web\\src\\components\\deviceRecord\\AddNewProduct.vue","mtime":1592905485771},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\n// import { provinceAndCityData, regionData, provinceAndCityDataPlus, regionDataPlus, CodeToText, TextToCode } from 'element-china-area-data';\r\nexport default {\r\n    name: 'AddNewProduct',\r\n    data() {\r\n        return {\r\n            // options: regionData,\r\n            form: {\r\n                eq: '',\r\n                device_name: '',\r\n                device_description: '',\r\n                device_type: '',\r\n                device_supplier: '',\r\n                address: '',\r\n                device_model: '',\r\n                principal: []\r\n            },\r\n            rules: {\r\n                eq: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备ID',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_name: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备名称',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_description: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入型号描述',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_type: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择设备种类',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                enterprise_id: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择所属企业',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                principal: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择负责人',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                device_supplier: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备厂家',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                address: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入详细地址',\r\n                        trigger: 'blur'\r\n                    }\r\n                ]\r\n            },\r\n\r\n            selectedOptions: '',\r\n            type: [],\r\n            enterprise: [],\r\n            user: [],\r\n            isTrue: true,\r\n            user_e: '',\r\n            dialogImageUrl: '',\r\n            dialogVisible: false,\r\n            newDeviceId: 1\r\n        };\r\n    },\r\n    created() {\r\n        this.fetchCaseInfo();\r\n    },\r\n    methods: {\r\n        fetchCaseInfo() {\r\n            axios({\r\n                method: 'get',\r\n                url: '/device/fetchCaseInfo'\r\n            })\r\n                .then(res => {\r\n                    window.console.log(res.data);\r\n                    this.type = res.data.type;\r\n                    this.enterprise = res.data.enterprise;\r\n                    this.user = res.data.user;\r\n                })\r\n                .catch(err => {});\r\n        },\r\n        fetchUserInfo(e) {\r\n            // this.user = this.user;\r\n            this.form.principal = '';\r\n            this.user_e = e;\r\n            this.isTrue = false;\r\n            window.console.log(e);\r\n        },\r\n\r\n        //提交表单\r\n        onSubmit(formName) {\r\n            this.$refs[formName].validate(valid => {\r\n                if (valid) {\r\n                    axios({\r\n                        method: 'post',\r\n                        url: '/device/addNewProduct',\r\n                        data: this.form\r\n                    })\r\n                        .then(res => {\r\n                            console.log(1);\r\n\r\n                            window.console.log(res.data);\r\n                            if (res.data.success) {\r\n                                this.$message.success(res.data.message);\r\n                                this.newDeviceId = res.data.insertId;\r\n                                // this.$refs.form.resetFields();\r\n                            }\r\n                        })\r\n                        .then(() => {\r\n                            this.$refs.uploadImg.submit();\r\n                            // this.$refs.uploadWord.submit();\r\n                            // window.console.log(res.data);\r\n                        })\r\n                        .then(() => {\r\n                            console.log(this.form);\r\n                            this.$router.push({\r\n                                path: '/deviceSettings',\r\n                                query: {\r\n                                    id: this.form.eq\r\n                                }\r\n                            });\r\n                            // this.$refs.uploadImg.clearFiles();\r\n                            // this.$refs.uploadWord.clearFiles();\r\n                        })\r\n                        .catch(err => {});\r\n                } else {\r\n                    console.log('error submit!!');\r\n                    return false;\r\n                }\r\n            });\r\n        },\r\n\r\n        //取消\r\n        resetForm(formName) {\r\n            this.$refs[formName].resetFields();\r\n            this.$refs.uploadImg.clearFiles();\r\n            // this.$refs.uploadWord.clearFiles();\r\n        },\r\n\r\n        //文件超出个数限制时的钩子\r\n        handleExceed6(files, fileList) {\r\n            this.$message.warning(\r\n                `当前限制选择 6 个图片，本次选择了 ${files.length} 个图片，共选择了 ${files.length + fileList.length} 个图片`\r\n            );\r\n        },\r\n        handleExceed3(files, fileList) {\r\n            this.$message.warning(\r\n                `当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`\r\n            );\r\n        },\r\n        //删除文件之前的钩子，参数为上传的文件和文件列表，若返回 false 或者返回 Promise 且被 reject，则停止删除。\r\n        beforeRemove(file, fileList) {\r\n            return this.$confirm(`确定移除 ${file.name}？`);\r\n        },\r\n        //文件上传成功时的钩子\r\n        // handleAvatarSuccess(response, file, fileList) {\r\n        //     window.console.log(response, file, fileList);\r\n        //     this.form.fileListImg = fileList;\r\n        // },\r\n        beforeAvatarUpload(file) {\r\n            const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n            if (!isLt2M) {\r\n                this.$message.error('上传图片,文件大小不能超过 2MB!');\r\n            }\r\n            return isLt2M;\r\n        }\r\n    }\r\n};\r\n",{"version":3,"sources":["AddNewProduct.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddNewProduct.vue","sourceRoot":"src/components/deviceRecord","sourcesContent":["<!--\r\n * @Author: your name\r\n * @Date: 2020-05-06 14:19:13\r\n * @LastEditTime: 2020-06-22 10:49:41\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\vue-manage-system\\src\\components\\view\\AddNewProduct.vue\r\n -->\r\n<template>\r\n    <div>\r\n        <div class=\"crumbs\">\r\n            <el-breadcrumb separator=\"/\">\r\n                <el-breadcrumb-item>\r\n                    <i class=\"el-icon-lx-calendar\"></i> 设备档案\r\n                </el-breadcrumb-item>\r\n                <el-breadcrumb-item>添加设备</el-breadcrumb-item>\r\n            </el-breadcrumb>\r\n        </div>\r\n        <div class=\"container\">\r\n            <el-button type=\"primary\" @click=\"$router.go(-1)\">返回</el-button>\r\n\r\n            <div class=\"form-box\">\r\n                <el-form ref=\"form\" :rules=\"rules\" :model=\"form\" label-width=\"120px\">\r\n                    <el-form-item label=\"设备ID\" prop=\"eq\">\r\n                        <el-input v-model=\"form.eq\" placeholder=\"例: 123456\"></el-input>\r\n                    </el-form-item>\r\n\r\n                    <el-form-item label=\"设备名称\" prop=\"device_name\">\r\n                        <el-input v-model=\"form.device_name\" placeholder=\"例: 设备一\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"设备型号\" prop=\"device_model\">\r\n                        <el-input v-model=\"form.device_model\" placeholder=\"例: iphone11\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"型号描述\" prop=\"device_description\">\r\n                        <el-input\r\n                            type=\"textarea\"\r\n                            v-model=\"form.device_description\"\r\n                            placeholder=\"例: 这是一个设备\"\r\n                        ></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"设备种类\" prop=\"device_type\">\r\n                        <el-select v-model=\"form.device_type\" placeholder=\"请选择设备种类\">\r\n                            <el-option\r\n                                v-for=\"item in type\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.typename\"\r\n                                :value=\"item.id\"\r\n                            ></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"所属企业\" prop=\"enterprise_id\">\r\n                        <el-select\r\n                            v-model=\"form.enterprise_id\"\r\n                            placeholder=\"请选择所属企业\"\r\n                            @change=\"fetchUserInfo(form.enterprise_id)\"\r\n                        >\r\n                            <el-option\r\n                                v-for=\"item in enterprise\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.enterprise_name\"\r\n                                :value=\"item.id\"\r\n                            ></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"设备负责人\" prop=\"principal\">\r\n                        <el-select v-model=\"form.principal\" placeholder=\"请选择负责人\" :disabled=\"isTrue\">\r\n                            <el-option\r\n                                v-for=\"item in user.filter(item => item.id == user_e)\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.username\"\r\n                                :value=\"item.id\"\r\n                            ></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"设备厂家\" prop=\"device_supplier\">\r\n                        <el-input v-model=\"form.device_supplier\" placeholder=\"例: 航天云网\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"详细地址\" prop=\"address\">\r\n                        <el-input v-model=\"form.address\" placeholder=\"例: 江苏省常州市竹林北路265号\"></el-input>\r\n                    </el-form-item>\r\n\r\n                    <el-form-item label=\"上传图片\">\r\n                        <el-upload\r\n                            multiple\r\n                            :data=\"{id: newDeviceId,\r\n                            type: 'img'}\"\r\n                            :headers=\"getAuthHeaders()\"\r\n                            class=\"upload-demo\"\r\n                            ref=\"uploadImg\"\r\n                            :action=\"axios.defaults.baseURL + '/device/upload'\"\r\n                            :file-list=\"form.fileListImg\"\r\n                            list-type=\"picture-card\"\r\n                            :limit=\"6\"\r\n                            :on-exceed=\"handleExceed6\"\r\n                            :before-remove=\"beforeRemove\"\r\n                            :before-upload=\"beforeAvatarUpload\"\r\n                            accept=\".png, .jpg, .jpeg\"\r\n                            :auto-upload=\"false\"\r\n                        >\r\n                            <i class=\"el-icon-plus\"></i>\r\n                            <div\r\n                                slot=\"tip\"\r\n                                class=\"el-upload__tip ml-2\"\r\n                            >只能上传jpg/png文件，且不超过2MB，最多上传3张图片</div>\r\n                        </el-upload>\r\n                        <el-dialog :visible.sync=\"dialogVisible\">\r\n                            <img width=\"100%\" :src=\"dialogImageUrl\" alt />\r\n                        </el-dialog>\r\n                    </el-form-item>\r\n                    <!-- <el-form-item label=\"上传文档\">\r\n                        <el-upload\r\n                            multiple\r\n                            :data=\"{id: newDeviceId,\r\n                            type: 'word'}\"\r\n                            :headers=\"getAuthHeaders()\"\r\n                            class=\"upload-demo\"\r\n                            ref=\"uploadWord\"\r\n                            :action=\"axios.defaults.baseURL + '/device/upload'\"\r\n                            :file-list=\"form.fileListWord\"\r\n                            list-type=\"text\"\r\n                            :limit=\"3\"\r\n                            :on-exceed=\"handleExceed3\"\r\n                            :before-remove=\"beforeRemove\"\r\n                            :before-upload=\"beforeAvatarUpload\"\r\n                            accept=\".pdf, .doc, .docx\"\r\n                            :auto-upload=\"false\"\r\n                        >\r\n                            <el-button size=\"small\" type=\"primary\">选取文件</el-button>\r\n                            <span\r\n                                slot=\"tip\"\r\n                                class=\"el-upload__tip ml-2\"\r\n                            >只能上传pdf/word文件，且不超过2MB，最多上传3份文档</span>\r\n                        </el-upload>\r\n                    </el-form-item>-->\r\n                    <el-form-item>\r\n                        <el-button type=\"primary\" @click=\"onSubmit('form')\">提交</el-button>\r\n                        <el-button @click=\"resetForm('form')\">取消</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n// import { provinceAndCityData, regionData, provinceAndCityDataPlus, regionDataPlus, CodeToText, TextToCode } from 'element-china-area-data';\r\nexport default {\r\n    name: 'AddNewProduct',\r\n    data() {\r\n        return {\r\n            // options: regionData,\r\n            form: {\r\n                eq: '',\r\n                device_name: '',\r\n                device_description: '',\r\n                device_type: '',\r\n                device_supplier: '',\r\n                address: '',\r\n                device_model: '',\r\n                principal: []\r\n            },\r\n            rules: {\r\n                eq: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备ID',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_name: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备名称',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_description: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入型号描述',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                device_type: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择设备种类',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                enterprise_id: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择所属企业',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                principal: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择负责人',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                device_supplier: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入设备厂家',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                address: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入详细地址',\r\n                        trigger: 'blur'\r\n                    }\r\n                ]\r\n            },\r\n\r\n            selectedOptions: '',\r\n            type: [],\r\n            enterprise: [],\r\n            user: [],\r\n            isTrue: true,\r\n            user_e: '',\r\n            dialogImageUrl: '',\r\n            dialogVisible: false,\r\n            newDeviceId: 1\r\n        };\r\n    },\r\n    created() {\r\n        this.fetchCaseInfo();\r\n    },\r\n    methods: {\r\n        fetchCaseInfo() {\r\n            axios({\r\n                method: 'get',\r\n                url: '/device/fetchCaseInfo'\r\n            })\r\n                .then(res => {\r\n                    window.console.log(res.data);\r\n                    this.type = res.data.type;\r\n                    this.enterprise = res.data.enterprise;\r\n                    this.user = res.data.user;\r\n                })\r\n                .catch(err => {});\r\n        },\r\n        fetchUserInfo(e) {\r\n            // this.user = this.user;\r\n            this.form.principal = '';\r\n            this.user_e = e;\r\n            this.isTrue = false;\r\n            window.console.log(e);\r\n        },\r\n\r\n        //提交表单\r\n        onSubmit(formName) {\r\n            this.$refs[formName].validate(valid => {\r\n                if (valid) {\r\n                    axios({\r\n                        method: 'post',\r\n                        url: '/device/addNewProduct',\r\n                        data: this.form\r\n                    })\r\n                        .then(res => {\r\n                            console.log(1);\r\n\r\n                            window.console.log(res.data);\r\n                            if (res.data.success) {\r\n                                this.$message.success(res.data.message);\r\n                                this.newDeviceId = res.data.insertId;\r\n                                // this.$refs.form.resetFields();\r\n                            }\r\n                        })\r\n                        .then(() => {\r\n                            this.$refs.uploadImg.submit();\r\n                            // this.$refs.uploadWord.submit();\r\n                            // window.console.log(res.data);\r\n                        })\r\n                        .then(() => {\r\n                            console.log(this.form);\r\n                            this.$router.push({\r\n                                path: '/deviceSettings',\r\n                                query: {\r\n                                    id: this.form.eq\r\n                                }\r\n                            });\r\n                            // this.$refs.uploadImg.clearFiles();\r\n                            // this.$refs.uploadWord.clearFiles();\r\n                        })\r\n                        .catch(err => {});\r\n                } else {\r\n                    console.log('error submit!!');\r\n                    return false;\r\n                }\r\n            });\r\n        },\r\n\r\n        //取消\r\n        resetForm(formName) {\r\n            this.$refs[formName].resetFields();\r\n            this.$refs.uploadImg.clearFiles();\r\n            // this.$refs.uploadWord.clearFiles();\r\n        },\r\n\r\n        //文件超出个数限制时的钩子\r\n        handleExceed6(files, fileList) {\r\n            this.$message.warning(\r\n                `当前限制选择 6 个图片，本次选择了 ${files.length} 个图片，共选择了 ${files.length + fileList.length} 个图片`\r\n            );\r\n        },\r\n        handleExceed3(files, fileList) {\r\n            this.$message.warning(\r\n                `当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`\r\n            );\r\n        },\r\n        //删除文件之前的钩子，参数为上传的文件和文件列表，若返回 false 或者返回 Promise 且被 reject，则停止删除。\r\n        beforeRemove(file, fileList) {\r\n            return this.$confirm(`确定移除 ${file.name}？`);\r\n        },\r\n        //文件上传成功时的钩子\r\n        // handleAvatarSuccess(response, file, fileList) {\r\n        //     window.console.log(response, file, fileList);\r\n        //     this.form.fileListImg = fileList;\r\n        // },\r\n        beforeAvatarUpload(file) {\r\n            const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n            if (!isLt2M) {\r\n                this.$message.error('上传图片,文件大小不能超过 2MB!');\r\n            }\r\n            return isLt2M;\r\n        }\r\n    }\r\n};\r\n</script>\r\n<style scoped>\r\n.form-box {\r\n    margin: 0 auto;\r\n}\r\n.avatar-uploader .el-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n    border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n}\r\n.avatar {\r\n    width: 178px;\r\n    height: 178px;\r\n    display: block;\r\n}\r\n</style>"]}]}
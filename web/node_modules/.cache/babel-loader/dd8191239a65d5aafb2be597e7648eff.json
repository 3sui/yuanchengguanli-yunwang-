{"remainingRequest":"D:\\git\\hualiyeya\\web\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js!D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js??ref--0-0!D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\hualiyeya\\web\\src\\components\\view\\map.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\git\\hualiyeya\\web\\src\\components\\view\\map.vue","mtime":1591579454596},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\git\\hualiyeya\\web\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { BmlMarkerClusterer } from 'vue-baidu-map'; // 引入marker\n\nimport BmMarker from 'vue-baidu-map/components/overlays/Marker';\nexport default {\n  name: 'maps',\n  data: function data() {\n    return {\n      drawerData: {},\n      drawer: false,\n      allDevice: null,\n      BMap: '',\n      map: '',\n      show: false,\n      deviceNum: 0\n    };\n  },\n  components: {\n    BmlMarkerClusterer: BmlMarkerClusterer,\n    BmMarker: BmMarker\n  },\n  computed: {},\n  created: function created() {\n    this.fetchAllDevice();\n    this.fetchDeviceNum();\n    this.fetchDeviceStatus();\n  },\n  methods: {\n    //显示侧边栏设备详情\n    showDrawer: function showDrawer(id) {\n      window.console.log(id);\n      this.drawerData = this.allDevice.filter(function (item) {\n        return item.eq == id;\n      })[0];\n      window.console.log(this.drawerData);\n      this.drawer = true;\n    },\n    // 关闭信息窗口 @close 自带的方法\n    infoWindowClose: function infoWindowClose(marker) {\n      marker.showFlag = false;\n      console.log(marker);\n    },\n    // 首先点击marker时开启信息窗口，其实没必要在 bm-info-window 上写 @open 因为如果是关闭状态根本就点不到，所以就无法触发 @open\n    // 如果在 bm-info-window 上写了 @open 在点击marker时会触发两次infoWindowOpen函数，而且可以很明显的看到有延时\n    infoWindowOpen: function infoWindowOpen(marker) {\n      marker.showFlag = true; // axios({\n      //     method: 'get',\n      //     url: 'getDeviceInfo',\n      //     query: ''\n      // });\n\n      console.log(marker);\n    },\n    //获取企业设备数量\n    fetchDeviceNum: function fetchDeviceNum() {\n      var _this2 = this;\n\n      axios({\n        method: 'get',\n        url: '/map/fetchDeviceNum'\n      }).then(function (res) {\n        if (res.data.success) {\n          _this2.deviceNum = res.data.data; // window.console.log(res.data.data);\n        }\n      }).catch();\n    },\n    //获取所有设备数据\n    fetchAllDevice: function fetchAllDevice() {\n      var _this3 = this;\n\n      // window.console.log(BMap);\n      axios({\n        method: 'get',\n        url: '/map/fetchAllDevice'\n      }).then(function (res) {\n        if (res.data.success) {\n          var bdGEO = function bdGEO() {\n            var _loop = function _loop(i) {\n              myGeo.getPoint(_this.allDevice[i].address, function (point) {\n                if (point) {\n                  _this.$set(_this.allDevice[i], 'lng', point.lng);\n\n                  _this.$set(_this.allDevice[i], 'lat', point.lat);\n\n                  _this.$set(_this.allDevice[i], 'showFlag', point.showFlag);\n                }\n              });\n            };\n\n            for (var i = 0; i < _this.allDevice.length; i++) {\n              _loop(i);\n            }\n          };\n\n          _this3.allDevice = res.data.data;\n          window.console.log(_this3.allDevice);\n          var addressArr = [];\n\n          _this3.allDevice.forEach(function (item) {\n            addressArr.push(item.address);\n          });\n          /***************************************** */\n\n\n          var index = 0;\n          var myGeo; //否则会报错BMap.Geocoder is not a constructor\n\n          setTimeout(function () {\n            myGeo = new BMap.Geocoder();\n            bdGEO();\n          }, 500);\n          var _this = _this3;\n          window.console.log(_this3.allDevice);\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["map.vue"],"names":[],"mappings":"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","sourcesContent":["<!--\r\n * @Author: your name\r\n * @Date: 2020-04-28 16:25:21\r\n * @LastEditTime: 2020-06-04 15:04:10\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\远程监控平台\\vue-manage-system\\src\\components\\page\\map.vue\r\n -->\r\n <template>\r\n    <div id=\"maps\">\r\n        <div class=\"crumbs\">\r\n            <el-breadcrumb separator=\"/\">\r\n                <el-breadcrumb-item>\r\n                    <i class=\"el-icon-lx-emoji\"></i> 用户地图\r\n                </el-breadcrumb-item>\r\n            </el-breadcrumb>\r\n        </div>\r\n        <div>\r\n            <el-row class=\"container\">\r\n                <el-col :span=\"18\">\r\n                    <div class=\"mapbox\">\r\n                        <baidu-map class=\"map\" center=\"中国\" :map-click=\"false\" v-if=\"allDevice\" :scroll-wheel-zoom=\"true\">\r\n                            <bml-marker-clusterer :averageCenter=\"true\">\r\n                                <div v-for=\"(marker, i) of allDevice\" :key=\"i\">\r\n                                    <bm-marker\r\n                                        :icon=\"{url: marker.status == '正常'? require('../../../public/bposition.png') : require('../../../public/rposition.png'), size: {width: 60, height: 60}}\"\r\n                                        :dragging=\"true\"\r\n                                        animation=\"BMAP_ANIMATION_BOUNCE\"\r\n                                        :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                        @click=\"infoWindowOpen(marker)\"\r\n                                    >\r\n                                        <bm-info-window\r\n                                            title=\"设备信息\"\r\n                                            :position=\"{lng: marker.lng, lat: marker.lat}\"\r\n                                            :show=\"marker.showFlag\"\r\n                                            @close=\"infoWindowClose(marker)\"\r\n                                            @open=\"infoWindowOpen(marker)\"\r\n                                        >\r\n                                            <p>公司: {{marker.device_supplier}}</p>\r\n                                            <p>地址: {{marker.address}}</p>\r\n                                            <p>设备ID: {{marker.eq}}</p>\r\n                                            <p>设备状态: {{marker.is_on?'开机':'关机'}}</p>\r\n                                            <p>设备报警: {{marker.status}}</p>\r\n                                            <el-button\r\n                                                class=\"my-2\"\r\n                                                @click=\"showDrawer(marker.eq)\"\r\n                                            >查看更多</el-button>\r\n                                        </bm-info-window>\r\n                                    </bm-marker>\r\n                                </div>\r\n                            </bml-marker-clusterer>\r\n                        </baidu-map>\r\n                    </div>\r\n                </el-col>\r\n                <el-col :span=\"6\">\r\n                    <div class=\"map-info\">\r\n                        <div class=\"info-one\">\r\n                            <p>{{deviceNum}}</p>\r\n                            <p>设备数量</p>\r\n                        </div>\r\n                        <div class=\"info-two\">\r\n                            <el-progress type=\"circle\" :percentage=\"100\"></el-progress>\r\n                            <div>\r\n                                <p>{{deviceNum}}</p>\r\n                                <p>运行设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-three\">\r\n                            <el-progress type=\"circle\" :percentage=\"0\"></el-progress>\r\n                            <div>\r\n                                <p>0</p>\r\n                                <p>关机设备数</p>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info-four\">\r\n                            <el-progress type=\"circle\" :percentage=\"0\"></el-progress>\r\n                            <div>\r\n                                <p>0</p>\r\n                                <p>待机设备数</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </el-col>\r\n            </el-row>\r\n        </div>\r\n        <el-drawer\r\n            :title=\"drawerData.device_name\"\r\n            :visible.sync=\"drawer\"\r\n            direction=\"rtl\"\r\n            size=\"35%\"\r\n        >\r\n            <div class=\"w-100 px-4\">\r\n                <div class=\"d-flex jc-around my-2\">\r\n                    <div class=\"img\">图片</div>\r\n                    <div class=\"img\">图片</div>\r\n                    <div class=\"img\">图片</div>\r\n                    <div class=\"img\">图片</div>\r\n                    <div class=\"img\">图片</div>\r\n                </div>\r\n                <p>设备id: {{drawerData.eq}}</p>\r\n                <p>设备名称: {{drawerData.device_name}}</p>\r\n                <p>设备型号: {{drawerData.device_model}}</p>\r\n                <p>工作状态: {{drawerData.status}}</p>\r\n                <p>设备地址: {{drawerData.address}}</p>\r\n                <p>设备负责人: {{drawerData.principal}}</p>\r\n\r\n                <el-button\r\n                    @click=\"$router.push({path: '/ProductDetails', query: drawerData.eq})\"\r\n                >跳转到详情页</el-button>\r\n            </div>\r\n        </el-drawer>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { BmlMarkerClusterer } from 'vue-baidu-map';\r\n// 引入marker\r\nimport BmMarker from 'vue-baidu-map/components/overlays/Marker';\r\n\r\nexport default {\r\n    name: 'maps',\r\n    data() {\r\n        return {\r\n            drawerData: {},\r\n            drawer: false,\r\n            allDevice: null,\r\n            BMap: '',\r\n            map: '',\r\n            show: false,\r\n            deviceNum: 0\r\n        };\r\n    },\r\n\r\n    components: {\r\n        BmlMarkerClusterer,\r\n        BmMarker\r\n    },\r\n\r\n    computed: {},\r\n    created() {\r\n        this.fetchAllDevice();\r\n        this.fetchDeviceNum();\r\n        this.fetchDeviceStatus();\r\n    },\r\n    methods: {\r\n        //显示侧边栏设备详情\r\n        showDrawer(id) {\r\n            window.console.log(id);\r\n            this.drawerData = this.allDevice.filter(item => {\r\n                return item.eq == id;\r\n            })[0];\r\n            window.console.log(this.drawerData);\r\n            this.drawer = true;\r\n        },\r\n        // 关闭信息窗口 @close 自带的方法\r\n        infoWindowClose(marker) {\r\n            marker.showFlag = false;\r\n            console.log(marker);\r\n        },\r\n        // 首先点击marker时开启信息窗口，其实没必要在 bm-info-window 上写 @open 因为如果是关闭状态根本就点不到，所以就无法触发 @open\r\n        // 如果在 bm-info-window 上写了 @open 在点击marker时会触发两次infoWindowOpen函数，而且可以很明显的看到有延时\r\n        infoWindowOpen(marker) {\r\n            marker.showFlag = true;\r\n            // axios({\r\n            //     method: 'get',\r\n            //     url: 'getDeviceInfo',\r\n            //     query: ''\r\n            // });\r\n            console.log(marker);\r\n        },\r\n        //获取企业设备数量\r\n        fetchDeviceNum() {\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchDeviceNum'\r\n            })\r\n                .then(res => {\r\n                    if (res.data.success) {\r\n                        this.deviceNum = res.data.data;\r\n                        // window.console.log(res.data.data);\r\n                    }\r\n                })\r\n                .catch();\r\n        },\r\n\r\n\r\n        //获取所有设备数据\r\n        fetchAllDevice() {\r\n            // window.console.log(BMap);\r\n            axios({\r\n                method: 'get',\r\n                url: '/map/fetchAllDevice'\r\n            }).then(res => {\r\n                if (res.data.success) {\r\n                    this.allDevice = res.data.data;\r\n                    window.console.log(this.allDevice);\r\n                    let addressArr = [];\r\n                    this.allDevice.forEach(item => {\r\n                        addressArr.push(item.address);\r\n                    });\r\n\r\n                    /***************************************** */\r\n                    var index = 0;\r\n                    var myGeo;\r\n\r\n                    //否则会报错BMap.Geocoder is not a constructor\r\n                    setTimeout(() => {\r\n                        myGeo = new BMap.Geocoder();\r\n                        bdGEO();\r\n                    }, 500);\r\n                    let _this = this;\r\n                    function bdGEO() {\r\n                        for (let i = 0; i < _this.allDevice.length; i++) {\r\n                            myGeo.getPoint(_this.allDevice[i].address, function(point) {\r\n                                if (point) {\r\n                                    _this.$set(_this.allDevice[i], 'lng', point.lng);\r\n                                    _this.$set(_this.allDevice[i], 'lat', point.lat);\r\n                                    _this.$set(_this.allDevice[i], 'showFlag', point.showFlag);\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    window.console.log(this.allDevice);\r\n                }\r\n            });\r\n        }\r\n    }\r\n};\r\n</script>\r\n<style scoped>\r\n.map {\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    margin-left: 20px;\r\n    height: calc(100vh - 220px);\r\n    min-height: 500px;\r\n}\r\n.map-info > div {\r\n    box-sizing: border-box;\r\n    /* margin-bottom: 13.3px; */\r\n    padding: 15px;\r\n    height: 22%;\r\n    background-color: #eef1f6;\r\n}\r\n.info-one {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    text-align: center;\r\n    line-height: 1.5;\r\n    font-size: 26px;\r\n    color: #333;\r\n}\r\n.info-two,\r\n.info-three,\r\n.info-four {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n}\r\n.info-two > div p:nth-child(1),\r\n.info-three > div p:nth-child(1),\r\n.info-four > div p:nth-child(1) {\r\n    font-size: 26px;\r\n}\r\n.img {\r\n    width: 90px;\r\n    height: 90px;\r\n    background: red;\r\n}\r\n</style>\r\n<style>\r\n.el-progress-circle {\r\n    height: 100px !important;\r\n    width: 100px !important;\r\n}\r\n.BMap_Marker img {\r\n    width: 40px;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components/view"}]}